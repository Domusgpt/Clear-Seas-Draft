:root {
  --global-focus-x: 0.5;
  --global-focus-y: 0.5;
  --global-focus-amount: 0;
  --global-scroll-momentum: 0;
  --global-scroll-tilt: 0deg;
  --global-synergy-glow: 0;
}

body {
  --global-background-shift-x: calc((var(--global-focus-x) - 0.5) * 12px + var(--global-scroll-momentum) * 18px);
  --global-background-shift-y: calc((0.5 - var(--global-focus-y)) * 10px);
  background-position: calc(50% + var(--global-background-shift-x)) calc(50% + var(--global-background-shift-y));
  transition: background-position 0.8s ease, filter 0.8s ease;
}

[data-global-card-group="true"] {
  position: relative;
  z-index: 0;
  --group-focus-amount: 0;
  --group-focus-x: 0.5;
  --group-focus-y: 0.5;
  --group-synergy: 0;
  transform-style: preserve-3d;
  transition: transform 0.6s ease, filter 0.6s ease, box-shadow 0.6s ease;
  overflow: visible;
}

[data-global-card-group="true"]::before {
  content: '';
  position: absolute;
  inset: -8% -6%;
  z-index: -2;
  border-radius: clamp(18px, 6vw, 48px);
  background: radial-gradient(
    circle at calc(var(--group-focus-x) * 100%) calc(var(--group-focus-y) * 100%),
    rgba(0, 255, 255, calc(0.08 + var(--group-focus-amount) * 0.35 + var(--group-synergy) * 0.25)),
    rgba(132, 56, 255, calc(0.05 + var(--group-synergy) * 0.25)) 48%,
    rgba(8, 10, 24, 0) 80%
  );
  opacity: calc(0.12 + var(--group-synergy) * 0.4);
  filter: blur(calc(28px - var(--group-focus-amount) * 12px));
  transform: translateZ(-60px) scale(calc(1 + var(--group-synergy) * 0.08));
  transition: opacity 0.6s ease, filter 0.6s ease, transform 0.6s ease;
  pointer-events: none;
}

[data-global-card-group="true"] > * {
  position: relative;
  z-index: 1;
}

[data-global-group-active="true"] {
  filter: saturate(calc(1 + var(--section-synergy, 0) * 0.35))
    brightness(calc(1 + var(--section-synergy, 0) * 0.15));
  transition: filter 0.6s ease;
}

[data-global-card-group="true"] :is(h1, h2, h3, h4, h5, h6,
  .section-title,
  .version-title,
  .card-title,
  .group-title,
  .section-intro,
  .version-description,
  .card-description) {
  transition: color 0.6s ease, text-shadow 0.6s ease, transform 0.6s ease;
}

[data-global-card-group="true"][data-global-group-active="true"] :is(h1, h2, h3, h4, h5, h6,
  .section-title,
  .version-title,
  .card-title,
  .group-title) {
  color: rgba(255, 255, 255, calc(0.82 + var(--group-focus-amount) * 0.25));
  text-shadow:
    0 0 calc(12px + var(--group-focus-amount) * 20px) rgba(0, 255, 255, 0.28),
    0 0 calc(22px + var(--group-synergy) * 40px) rgba(132, 56, 255, 0.24);
  transform: translateZ(calc(var(--group-focus-amount) * 12px));
}

[data-global-card-group="true"][data-global-group-active="true"] :is(.section-intro,
  .version-description,
  .card-description) {
  color: rgba(255, 255, 255, calc(0.68 + var(--group-synergy) * 0.2));
  text-shadow: 0 0 calc(10px + var(--group-synergy) * 16px) rgba(0, 255, 255, 0.18);
}

.global-visualizer-card,
[data-visualizer-card] {
  position: relative;
  transform-style: preserve-3d;
  --card-focus-x: 0.5;
  --card-focus-y: 0.5;
  --card-focus-strength: 0;
  --card-support-intensity: 0;
  --card-scroll-momentum: 0;
  --card-twist: 0deg;
  --card-pulse: 0;
  --card-overlay-shift: 0px;
  --card-visibility-factor: var(--card-visibility, 1);
  --support-distance-z: 0px;
  --support-distance-glow: 0;
  transition:
    box-shadow 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),
    border-color 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),
    filter 0.6s ease,
    opacity 0.6s ease;
  will-change: transform, box-shadow, filter;
  contain: layout paint;
  opacity: calc(0.68 + var(--card-visibility-factor) * 0.32);
}

.global-visualizer-card[data-support-role="primary"],
[data-visualizer-card][data-support-role="primary"] {
  z-index: 5;
  filter: saturate(calc(1.05 + var(--card-focus-strength) * 0.45))
    brightness(calc(1 + var(--card-focus-strength) * 0.2));
}

.global-visualizer-card[data-support-distance="0"],
[data-visualizer-card][data-support-distance="0"] {
  --support-distance-z: 22px;
  --support-distance-glow: 0.24;
}

.global-visualizer-card[data-support-distance="1"],
[data-visualizer-card][data-support-distance="1"] {
  --support-distance-z: 14px;
  --support-distance-glow: 0.16;
}

.global-visualizer-card[data-support-distance="2"],
[data-visualizer-card][data-support-distance="2"] {
  --support-distance-z: 8px;
  --support-distance-glow: 0.08;
}

.global-visualizer-card[data-support-distance="visible"],
[data-visualizer-card][data-support-distance="visible"] {
  --support-distance-z: 10px;
  --support-distance-glow: 0.12;
}

.global-visualizer-card[data-support-distance="far"],
[data-visualizer-card][data-support-distance="far"] {
  --support-distance-z: -8px;
  --support-distance-glow: -0.06;
}

.global-visualizer-card[data-support-role="supporting"],
[data-visualizer-card][data-support-role="supporting"] {
  opacity: calc(0.82 + var(--card-support-intensity) * 0.18);
  filter: saturate(calc(0.86 + var(--card-focus-strength) * 0.2));
  transform: perspective(1600px)
    rotateX(calc((0.5 - var(--card-focus-y)) * 22deg + var(--card-scroll-momentum) * 4deg))
    rotateY(calc((var(--card-focus-x) - 0.5) * 20deg))
    rotateZ(calc(var(--card-twist) * 0.82))
    translateZ(calc(var(--card-focus-strength) * 26px))
    scale(calc(1 + var(--card-focus-strength) * 0.04 + var(--card-support-intensity) * 0.02));
}

.global-visualizer-card[data-support-role="ambient"],
[data-visualizer-card][data-support-role="ambient"] {
  opacity: calc(0.72 + var(--card-support-intensity) * 0.2);
  filter: saturate(calc(0.78 + var(--card-focus-strength) * 0.18));
  transform: perspective(1500px)
    rotateX(calc((0.5 - var(--card-focus-y)) * 18deg + var(--card-scroll-momentum) * 2deg))
    rotateY(calc((var(--card-focus-x) - 0.5) * 18deg))
    rotateZ(calc(var(--card-twist) * 0.65))
    translateZ(calc(var(--card-focus-strength) * 18px))
    scale(calc(0.98 + var(--card-support-intensity) * 0.02));
}

.global-visualizer-card[data-support-role="neutral"],
[data-visualizer-card][data-support-role="neutral"] {
  opacity: 1;
}

.global-visualizer-card::before,
[data-visualizer-card]::before {
  content: '';
  position: absolute;
  inset: -14%;
  background: radial-gradient(
    circle at calc(var(--card-focus-x) * 100%) calc(var(--card-focus-y) * 100%),
    rgba(0, 255, 255, calc(0.18 + var(--card-focus-strength) * 0.4 + var(--card-support-intensity) * 0.2)),
    rgba(132, 56, 255, calc(0.12 + var(--card-support-intensity) * 0.25)) 45%,
    rgba(12, 12, 32, 0) 78%
  );
  opacity: calc(0.35 + var(--card-focus-strength) * 0.5 + var(--card-support-intensity) * 0.25 + var(--group-synergy, 0) * 0.3 + var(--support-distance-glow, 0) + (var(--card-visibility-factor) - 1) * 0.15);
  filter: blur(calc(22px - var(--card-focus-strength) * 8px - var(--group-synergy, 0) * 6px + (1 - var(--card-visibility-factor)) * 6px));
  transform: translateZ(calc(-24px + var(--support-distance-glow, 0) * 60px)) scale(calc(1.08 + var(--group-synergy, 0) * 0.06));
  pointer-events: none;
  z-index: 0;
  transition: opacity 0.6s ease, filter 0.6s ease;
}

.global-visualizer-card::after,
[data-visualizer-card]::after {
  content: '';
  position: absolute;
  inset: -8%;
  border-radius: inherit;
  border: 1px solid rgba(255, 255, 255, calc(0.1 + var(--card-support-intensity) * 0.3 + var(--support-distance-glow, 0) * 0.4));
  opacity: calc(0.25 + var(--card-focus-strength) * 0.35 + var(--group-synergy, 0) * 0.2 + var(--support-distance-glow, 0) * 0.6 + (var(--card-visibility-factor) - 1) * 0.12);
  filter: blur(calc(6px - var(--card-focus-strength) * 2px - var(--group-synergy, 0) * 1.2px + (1 - var(--card-visibility-factor)) * 2px));
  pointer-events: none;
  z-index: 1;
  mix-blend-mode: screen;
  transition: opacity 0.6s ease, filter 0.6s ease;
}

.global-visualizer-card,
[data-visualizer-card] {
  transform:
    perspective(1600px)
    rotateX(calc((0.5 - var(--card-focus-y)) * 26deg + var(--card-scroll-momentum) * 6deg))
    rotateY(calc((var(--card-focus-x) - 0.5) * 28deg))
    rotateZ(calc(var(--card-twist)))
    translateZ(calc(var(--card-focus-strength) * 48px + var(--support-distance-z)))
    scale(calc(1 + var(--card-focus-strength) * 0.06 + var(--card-support-intensity) * 0.03));
  box-shadow:
    0 30px 70px rgba(8, 12, 32, calc((0.25 + var(--card-focus-strength) * 0.35) * (0.5 + var(--card-visibility-factor) * 0.5))),
    0 12px 34px rgba(0, 240, 255, calc((0.12 + var(--card-support-intensity) * 0.3) * (0.5 + var(--card-visibility-factor) * 0.5))),
    inset 0 1px 0 rgba(255, 255, 255, calc((0.2 + var(--card-focus-strength) * 0.3) * (0.6 + var(--card-visibility-factor) * 0.4)));
  border: 1px solid rgba(255, 255, 255, calc(0.18 + var(--card-focus-strength) * 0.35));
  filter: saturate(calc(1 + var(--card-focus-strength) * 0.4 + var(--card-support-intensity) * 0.3))
    brightness(calc(1 + var(--card-support-intensity) * 0.15 + (var(--card-visibility-factor) - 1) * 0.08));
}

.global-visualizer-card .global-brand-overlay,
[data-visualizer-card] .global-brand-overlay {
  position: absolute;
  inset: -22%;
  z-index: 2;
  border-radius: inherit;
  pointer-events: none;
  background-size: cover;
  background-position: center;
  opacity: calc(0.2 + var(--card-focus-strength) * 0.55 + var(--card-support-intensity) * 0.35 + var(--group-synergy, 0) * 0.18 + (var(--card-visibility-factor) - 1) * 0.25 + var(--support-distance-glow, 0) * 0.5);
  mix-blend-mode: screen;
  filter: saturate(calc(1.2 + var(--card-focus-strength) * 1.4 + var(--group-synergy, 0) * 0.6))
    blur(calc((0.4 - var(--card-focus-strength) * 0.3 - var(--group-synergy, 0) * 0.1 + (1 - var(--card-visibility-factor)) * 0.2) * 18px));
  transform:
    translateZ(calc(18px + var(--card-focus-strength) * 36px + var(--group-synergy, 0) * 24px + var(--support-distance-z) * 0.4))
    rotateX(calc(var(--card-scroll-momentum) * -1.8deg + var(--group-synergy, 0) * -1.2deg))
    rotateY(calc(var(--card-scroll-momentum) * 1.6deg + var(--group-synergy, 0) * 1.1deg));
  transition: opacity 0.5s ease, filter 0.6s ease, transform 0.6s ease;
}

.global-brand-overlay video,
.global-brand-overlay img {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0.9;
  filter: inherit;
  mix-blend-mode: inherit;
}

.global-brand-overlay::after {
  content: '';
  position: absolute;
  inset: -10%;
  background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.45), rgba(255, 255, 255, 0));
  opacity: calc(0.45 + var(--card-focus-strength) * 0.4 + (var(--card-visibility-factor) - 1) * 0.2);
  transform: translateZ(12px);
}

.global-visualizer-card canvas[data-visualizer],
.global-visualizer-card canvas[data-vib34d],
.global-visualizer-card canvas[class*="visualizer"],
.global-visualizer-card canvas[class*="hologram"],
.global-visualizer-card .holographic-canvas canvas,
[data-visualizer-card] canvas[data-visualizer],
[data-visualizer-card] canvas[data-vib34d],
[data-visualizer-card] canvas[class*="visualizer"],
[data-visualizer-card] canvas[class*="hologram"],
[data-visualizer-card] .holographic-canvas canvas {
  position: absolute;
  inset: -18%;
  width: 136%;
  height: 136%;
  transform:
    translateZ(calc(-36px + var(--card-focus-strength) * -18px - var(--group-synergy, 0) * 16px + var(--support-distance-z) * -0.6))
    rotateX(calc((0.5 - var(--card-focus-y)) * 18deg + var(--card-scroll-momentum) * 4deg + var(--group-synergy, 0) * 2deg))
    rotateY(calc((var(--card-focus-x) - 0.5) * 18deg + var(--group-synergy, 0) * -2deg));
  filter: saturate(calc(1.1 + var(--card-focus-strength) * 0.4 + var(--group-synergy, 0) * 0.25 + (var(--card-visibility-factor) - 1) * 0.3));
  pointer-events: none;
  transition: transform 0.6s ease, filter 0.6s ease;
}

.global-visualizer-card[data-has-focus="true"]::before,
[data-visualizer-card][data-has-focus="true"]::before {
  opacity: calc(0.5 + var(--card-focus-strength) * 0.35);
}

.global-visualizer-card[data-has-focus="true"]::after,
[data-visualizer-card][data-has-focus="true"]::after {
  opacity: calc(0.38 + var(--card-focus-strength) * 0.4);
}

.global-visualizer-card .supporting-layer,
[data-visualizer-card] .supporting-layer {
  transform: translateZ(calc(-20px + var(--card-support-intensity) * -10px));
  opacity: calc(0.6 + var(--card-support-intensity) * 0.4);
  transition: transform 0.6s ease, opacity 0.6s ease;
}

.global-visualizer-card[data-interaction-active="true"],
[data-visualizer-card][data-interaction-active="true"] {
  filter: brightness(calc(1.05 + var(--card-focus-strength) * 0.2));
}

@media (prefers-reduced-motion: reduce) {
  .global-visualizer-card,
  [data-visualizer-card] {
    transition: none;
    transform: none !important;
    box-shadow: none;
  }

  .global-visualizer-card::before,
  [data-visualizer-card]::before,
  .global-visualizer-card::after,
  [data-visualizer-card]::after,
  .global-visualizer-card .global-brand-overlay,
  [data-visualizer-card] .global-brand-overlay {
    transition: none;
  }
}
